<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>Test page</title>

	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
	$.fn.table_of_contents = function(options) {
		options = (typeof(options) == 'undefined') ? {} : options;
		
		let toc_container = $(options.container);
		let this_container = $(this);
		let headlines = $(":header", this_container);
		
		if(0 == headlines.length)
		{
			return;
		}
		
		let scrollToHeadline = function(target) 
		{
			$("body, html").animate(
				{'scrollTop': $(target).offset().top + options.scrollOffset},
				options.scrollSpeed,
				function() {}
			);
		};
				
		let last_scroll_position = 0;
		let ticking = false;
		
		$(document).scroll(function() {
			const middle = window.scrollY + (window.innerHeight / 2);
			
			$(toc_container).find("ul li a").each(function(index, elmt) {
				$(elmt).css("font-weight", "normal");
			});
			
			headlines.each(function(index, headline) {
				let headline_id = $(headline).prop("id");
				let href = $("li a[href='#" + headline_id + "']");
				
				if(window.scrollY <= $(headline).offset().top && $(headline).offset().top <= window.scrollY + window.innerHeight)
				{
					href.css("font-weight", "bold");
				}
			});
			
		});
		
		let tocHTML = "<ul class='__scroll-to-headline__'>";
		
		let top_level = headlines[0].tagName.replace(/[^\d]/g, ""); // 숫자가 아닌 모든 것을 ""변경. 결국 숫자만 뽑겠다는 의미
		
		headlines.each(function(headline_index, headline) {
			var sub_level = headline.tagName.replace(/[^\d]/g, "");
			if (sub_level > top_level) { // 하위
				for (let i = sub_level; i > top_level; i--) {
					tocHTML += "<ul>";
				}
			} 
			else if(sub_level < top_level) {
				for (let i = sub_level; i < top_level; i++) {
					tocHTML += "</ul>";
				}
			}
			top_level = sub_level;
			
			let headline_unique_id = "headline_unique_id_" + headline_index;
			let headlineElmt = $(headline);
			let headlineText = headlineElmt.text();
			
			headlineElmt.prop("id", headline_unique_id);
			tocHTML += "<li id='li_" + headline_unique_id +"'><a href='#" + headline_unique_id + "'>" + headlineText + "</a></li>";
		});
		
		
		tocHTML += "</ul>";
		toc_container.append($(tocHTML));
		
		$("li a", $(".__scroll-to-headline__")).click(function(e) {
			e.preventDefault();
			
			const target = $(e.target).attr('href');
			scrollToHeadline(target);
		});
		//});
	};
	
	
	$(document).ready(function() {
		$('article').table_of_contents({
			container: "#toc",
			scrollSpeed: 600,
			scrollOffset: -10
		});
	});
	</script>

	<style>
		main {
			justify-content: center;
			display: flex;
		}
		
		main aside.left {
			background-color : pink;
			width: 300px;
			border: 1px solid;
		}
		
		main article {
			flex: 1;
			background-color : yellow;
			border: 1px solid;
		}
		
		main aside.right {
			width: 300px;
			background-color : pink;
			border: 1px solid;
		}
		
		@media screen and (max-width: 1424px) {
			main aside.right {
				display: none;
			}
		}
		
		@media screen and (max-width: 768px) {
			main aside.left {
				display: none;
			}
		}
		@media screen and (min-width: 1024px) {
			main article {
				flex: none;
				width: 768px;
			}
		}

		main aside.left #toc {
			position: -webkit-sticky;
			position: sticky;
			top: 0px;
			background-color: #cae8ca;
			border: 1px solid #4caf50;
		}
		
		#toc li::marker {
			color: red;
		}
	</style>
  
</head>

<body>
<main role="main">
	<aside class="left">
		left
		<div id="toc">
		
		</div>
	</aside>
	<article>
		<div>
			<ul> Title
				<li>Title 1</li>
				<ul>
					<li>Sub Title</li>
					<ul>
						<li>Sub Title</li>
					</ul>
				</ul>
				<li>Title 2</li>
			</ul>
			<div>
			<h1>BEGIN</h1>
			<h2>sub title1</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h4>more</h4>
			<h5>more more more</h5>
			<h6>more more more</h6>
			<!--
			<h2>sub title2</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h1>title2</h1>
			<h2>sub title1</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h2>sub title2</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			
			<h1>title3</h1>
			<h2>sub title1</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h2>sub title2</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h1>title1</h1>
			<h2>sub title1</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h2>sub title2</h2>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			<h3>content</h3>
			<p>가나다라 마바사아 자차카타 파하가나 다라마바 사아자차 카타파하 가나다라 마바사아 자차카타 파하가나 다라마바</p>
			<p>ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGHIJKLMNOPQRSTUVWXYZ ABCDEFGGH</p>
			<p>1234567890 1234567890 1234567890 1234567890 1234567890 1234567890</p>
			

			<p>End of Contents</p>
			<div id="contents-end"></div>
			-->
		</div>
	</article>
	<aside class="right">
		right
	</aside>

</main>
</body>

</html>
